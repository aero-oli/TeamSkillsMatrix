{% extends "base.html" %}

{% block title %}Admin{% endblock %}

{% block content %}
<div class="row mb-4 align-items-center">
    <div class="col">
        <h1 class="display-5 fw-bold text-primary mb-0">Admin Panel</h1>
        <p class="text-muted mt-2">System administration and management</p>
    </div>
</div>

<!-- Navigation Tabs -->
<ul class="nav nav-tabs mb-4" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" 
                id="employee-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#employee-management" 
                type="button" 
                role="tab">
            <i class="fas fa-users me-2"></i>Employee Management
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" 
                id="skills-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#skills-management" 
                type="button" 
                role="tab">
            <i class="fas fa-star me-2"></i>Skills Management
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" 
                id="options-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#options-management" 
                type="button" 
                role="tab">
            <i class="fas fa-cogs me-2"></i>Options Management
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" 
                id="tools-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#tools-management" 
                type="button" 
                role="tab">
            <i class="fas fa-tools me-2"></i>Tools
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content">
    <!-- Employee Management Tab -->
    <div class="tab-pane fade show active" id="employee-management" role="tabpanel">
        <div class="row g-4">
            <!-- Admin Users Management -->
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header bg-white py-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Admin Users</h5>
                            <button type="button" 
                                    class="btn btn-primary btn-sm" 
                                    data-bs-toggle="modal" 
                                    data-bs-target="#addAdminModal">
                                <i class="fas fa-user-plus me-2"></i>Add Admin
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- Admin users table content -->
                        {% include '_admin_users_table.html' %}
                    </div>
                </div>
            </div>

            <!-- Employee Management -->
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header bg-white py-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Employee Management</h5>
                            <a href="{{ url_for('add_employee') }}" class="btn btn-primary btn-sm">
                                <i class="fas fa-user-plus me-2"></i>Add Employee
                            </a>
                        </div>
                        <!-- Employee search form -->
                        <div class="mt-3">
                            <form method="GET" class="d-flex gap-2">
                                <div class="flex-grow-1">
                                    <div class="input-group">
                                        <input type="text" 
                                               class="form-control" 
                                               placeholder="Search employees..." 
                                               name="employee_search"
                                               value="{{ employee_search }}">
                                        <button class="btn btn-outline-primary" type="submit">
                                            <i class="fas fa-search"></i>
                                        </button>
                                        {% if employee_search %}
                                            <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary">
                                                <i class="fas fa-times"></i>
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- Employee table content -->
                        {% include '_employee_table.html' %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Skills Management Tab -->
    <div class="tab-pane fade" id="skills-management" role="tabpanel">
        <div class="card">
            <div class="card-header bg-white py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Skills Management</h5>
                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addSkillModal">
                        <i class="fas fa-plus me-2"></i>Add Skill
                    </button>
                </div>
                <!-- Skills search form -->
                <div class="mt-3">
                    <form method="GET" class="d-flex gap-2">
                        <div class="flex-grow-1">
                            <div class="input-group">
                                <input type="text" 
                                       class="form-control" 
                                       placeholder="Search skills..." 
                                       name="skill_search"
                                       value="{{ skill_search }}">
                                <button class="btn btn-outline-primary" type="submit">
                                    <i class="fas fa-search"></i>
                                </button>
                                {% if skill_search %}
                                    <a href="{{ url_for('admin') }}" class="btn btn-outline-secondary">
                                        <i class="fas fa-times"></i>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card-body p-0">
                <!-- Skills table content -->
                {% include '_skills_table.html' %}
            </div>
        </div>
    </div>

    <!-- Options Management Tab -->
    <div class="tab-pane fade" id="options-management" role="tabpanel">
        <div class="row g-4">
            <!-- Projects Section -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-white py-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Projects</h5>
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addProjectModal">
                                <i class="fas fa-plus me-2"></i>Add Project
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- Projects table content -->
                        {% include '_projects_table.html' %}
                    </div>
                </div>
            </div>

            <!-- Levels Section -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-white py-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Employee Levels</h5>
                            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addLevelModal">
                                <i class="fas fa-plus me-2"></i>Add Level
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- Levels table content -->
                        {% include '_levels_table.html' %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tools Management Tab -->
    <div class="tab-pane fade" id="tools-management" role="tabpanel">
        <div class="card">
            <div class="card-header bg-white py-3">
                <h5 class="card-title mb-0">Database Management</h5>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card h-100 bg-light border-0">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-download me-2"></i>Backup Database
                                </h5>
                                <p class="card-text text-muted mb-4">
                                    Download a complete backup of the database in SQLite format.
                                    This backup can be used to restore the system if needed.
                                </p>
                                <a href="{{ url_for('backup_database') }}" class="btn btn-primary">
                                    <i class="fas fa-download me-2"></i>Download Backup
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 bg-light border-0">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-upload me-2"></i>Restore Database
                                </h5>
                                <p class="card-text text-muted mb-4">
                                    Restore the database from a previous backup file.
                                    Warning: This will overwrite all current data.
                                </p>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#restoreDatabaseModal">
                                    <i class="fas fa-upload me-2"></i>Restore from Backup
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include all the existing modals -->
{% include '_admin_modals.html' %}

<style>
/* Custom styling for tabs */
.nav-tabs {
    border-bottom: 2px solid #dee2e6;
    background-color: #ffffff;
}

/* Base tab styling */
.nav-tabs .nav-link {
    border: none;
    padding: 1rem 1.5rem;
    font-weight: 600;
    font-size: 1.1rem;
    transition: all 0.2s ease;
    position: relative;
    background-color: #ffffff;
    color: #495057 !important;
}

/* Individual tab styling */
#employee-tab, #skills-tab, #options-tab, #tools-tab {
    color: #495057 !important;
    text-shadow: 0 0 1px rgba(0,0,0,0.1);
}

/* Hover and active states */
.nav-tabs .nav-link:hover {
    color: #dc3545 !important;
    border: none;
    background: #f8f9fa;
}

.nav-tabs .nav-link.active {
    color: #dc3545 !important;
    border: none;
    background: #ffffff;
    box-shadow: none;
    font-weight: 700;
}

.nav-tabs .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: #dc3545;
}

/* Make the icons more visible */
.nav-tabs .nav-link i {
    opacity: 0.9;
    margin-right: 0.5rem;
}

.nav-tabs .nav-link.active i {
    opacity: 1;
}

/* Card styling - light theme */
.card {
    margin-bottom: 1.5rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    background-color: #ffffff;
    border: 1px solid rgba(0, 0, 0, 0.125);
}

.tab-pane {
    padding: 1.5rem 0;
}

/* Text styling for light theme */
.card-title {
    color: #212529;
    font-weight: 600;
}

.text-muted {
    color: #6c757d !important;
}

/* Card header styling */
.card-header {
    background-color: #ffffff !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.125);
}

/* Table styling for light theme */
.table {
    color: #212529;
}

.table-light {
    background-color: #f8f9fa;
    color: #212529;
}

.table-hover tbody tr:hover {
    background-color: rgba(0, 0, 0, 0.075);
}

/* Database management cards specific styling */
#tools-management .card.bg-light {
    background-color: #f8f9fa !important;
}

#tools-management .card-title {
    color: #212529;
    margin-bottom: 1rem;
}

#tools-management .card-text {
    color: #6c757d !important;
}
</style>

<script>
// Preserve active tab after form submissions
document.addEventListener('DOMContentLoaded', function() {
    // Get active tab from URL hash or localStorage
    var activeTab = window.location.hash || localStorage.getItem('adminActiveTab') || '#employee-management';
    
    // Activate the tab
    var tab = new bootstrap.Tab(document.querySelector('button[data-bs-target="' + activeTab + '"]'));
    tab.show();
    
    // Store active tab when changed
    var tabElements = document.querySelectorAll('button[data-bs-toggle="tab"]');
    tabElements.forEach(function(tabElement) {
        tabElement.addEventListener('shown.bs.tab', function (e) {
            localStorage.setItem('adminActiveTab', e.target.dataset.bsTarget);
        });
    });
});
</script>
{% endblock %} 